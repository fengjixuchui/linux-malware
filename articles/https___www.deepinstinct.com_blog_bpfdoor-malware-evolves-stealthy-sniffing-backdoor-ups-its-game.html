<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>BPFDoor Malware Evolves – Stealthy Sniffing Backdoor ups its Game | Deep Instinct</title><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/><meta name="description" content="BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise. The malware gets its name from its usage of a Berkley Packet Filter – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic. "/><link type="text/css" rel="stylesheet" data-href="https://use.typekit.net/zka3qml.css" data-optimized-fonts="true"/><link href="https://www.deepinstinct.com/blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game" rel="canonical"/><link href="https://www.deepinstinct.com/blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game" hrefLang="x-default" rel="alternate"/><link href="https://www.deepinstinct.com/blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game" hrefLang="en" rel="alternate"/><meta property="og:title" content="BPFDoor Malware Evolves – Stealthy Sniffing Backdoor ups its Game | Deep Instinct"/><meta property="og:description" content="BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise. The malware gets its name from its usage of a Berkley Packet Filter – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic. "/><meta property="og:url" content="https://www.deepinstinct.com/blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game"/><meta property="og:image" content="https://www.deepinstinct.com/image/bltd8c463dc3a603391/645bdd954ebc818bac33eac7/blog-image-bpfdoor-malware.jpg"/><meta property="og:site_name" content="Deep Instinct"/><meta property="article:published_time" content="2023-05-10T18:00:00.000Z"/><meta property="article:modified_time" content="2023-05-11T17:29:17.879Z"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@DeepInstinctSec"/><meta name="twitter:title" content="BPFDoor Malware Evolves – Stealthy Sniffing Backdoor ups its Game | Deep Instinct"/><meta name="twitter:description" content="BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise. The malware gets its name from its usage of a Berkley Packet Filter – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic. "/><meta name="twitter:image" content="https://www.deepinstinct.com/image/bltd8c463dc3a603391/645bdd954ebc818bac33eac7/blog-image-bpfdoor-malware.jpg"/><meta class="swiftype" name="title" data-type="string" content="BPFDoor Malware Evolves – Stealthy Sniffing Backdoor ups its Game | Deep Instinct"/><meta class="swiftype" name="description" data-type="string" content="BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise. The malware gets its name from its usage of a Berkley Packet Filter – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic. "/><meta class="swiftype" name="language" data-type="string" content="en"/><meta class="swiftype" name="last_modified" data-type="date" content="2023-05-11T17:29:17.879Z"/><script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://www.deepinstinct.com/#website",
      "url":"https://www.deepinstinct.com/",
      "name":"Deep Instinct",
      "description":"The Deep Learning AI Cybersecurity Platform, Offering Cyber Threat Prevention Solutions.",
      "inLanguage":"en"
    },
    {
      "@type":"WebPage",
      "@id":"https://www.deepinstinct.com/blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game#webpage",
      "url":"https://www.deepinstinct.com/blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game",
      "name":"BPFDoor Malware Evolves – Stealthy Sniffing Backdoor ups its Game | Deep Instinct",
      "isPartOf":{"@id":"https://www.deepinstinct.com/#website"},
      "datePublished":"2023-05-10T18:00:00.000Z",
      "dateModified":"2023-05-11T17:29:17.879Z",
      "description":"BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise. The malware gets its name from its usage of a Berkley Packet Filter – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic. ",
      "inLanguage":"en"
    }
  ]
}
  </script><script src="https://www.googleoptimize.com/optimize.js?id=OPT-P298HTJ"></script><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><meta name="next-head-count" content="32"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-52PC3MW');</script><link rel="preload" href="/_next/static/css/d94da3dc1af2f858.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d94da3dc1af2f858.css" data-n-g=""/><link rel="preload" href="/_next/static/css/1252b2b9b52a8111.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1252b2b9b52a8111.css" data-n-p=""/><link rel="preload" href="/_next/static/css/e24af18bfed2b9e3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e24af18bfed2b9e3.css"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script defer="" src="/_next/static/chunks/5935-c757cc9152444a3d.js"></script><script defer="" src="/_next/static/chunks/6329-831a74148bce6612.js"></script><script defer="" src="/_next/static/chunks/248.0db1e1c53eb42682.js"></script><script src="/_next/static/chunks/webpack-ddf2a6ea8abc3675.js" defer=""></script><script src="/_next/static/chunks/framework-a070cbfff3c750c5.js" defer=""></script><script src="/_next/static/chunks/main-56046b3e412722f8.js" defer=""></script><script src="/_next/static/chunks/pages/_app-de8101c0d8fecbbe.js" defer=""></script><script src="/_next/static/chunks/5675-33a595ecead4a5e3.js" defer=""></script><script src="/_next/static/chunks/9366-e4dac70fdca9d72a.js" defer=""></script><script src="/_next/static/chunks/6368-3bba50d004313494.js" defer=""></script><script src="/_next/static/chunks/6804-8e18f115671d1a69.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpid%5D-8fc23f09fa5ca4f0.js" defer=""></script><script src="/_next/static/m35S_mu-AiQUHee5tDoVa/_buildManifest.js" defer=""></script><script src="/_next/static/m35S_mu-AiQUHee5tDoVa/_ssgManifest.js" defer=""></script><link rel="stylesheet" href="https://use.typekit.net/zka3qml.css"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-52PC3MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next" data-reactroot=""><div><div class="site-wide-alert bg-blue"><div class="container--full"><div class="container"><div class="site-wide-alert__content text-center py-2"><h2 class="site-wide-alert__title text-m my-1 mr-3 inline-block text-white">Deep Instinct Included in the 2022 Gartner® Magic Quadrant™ for Endpoint Protection Platforms (EPP)</h2><a class="inline-block font-bold uppercase text-cta tracking-widder undefined button_btn--link__eEiq4 undefined button_btn--arrow-yellow__8W65R text-yellow" href="/blog/who-is-the-only-new-vendor-in-the-2022-gartner-magic-quadrant-for-endpoint-protection-platforms">Learn more<i class="button_btn__icon__luCR1"></i></a></div></div></div></div><header class="header top-0 z-50 relative header_header__A5I_i header_white__oSyU8 sticky"><div id="header-inner" class="pt-4 pb-3 lg:pt-6 lg:pb-5 w-full header_header-inner__i2Orb"><div data-focus-guard="true" tabindex="-1" style="width:1px;height:0px;padding:0;overflow:hidden;position:fixed;top:1px;left:1px"></div><div data-focus-lock-disabled="disabled"><div class="lg:flex lg:justify-between container header_header-wrap__1U5c_"><div class="flex justify-between lg:items-center"><a aria-label="to home page" class="logo_logo-wrap__TtbPy" href="/"></a><button data-autofocus="false" aria-label="open menu" class="bg-yellow items-center flex justify-center rounded-full z-50 lg:hidden button-menu_header__button__ELNSv"><span class="sr-only block">Open menu</span><span class="sr-only hidden">Close menu</span><span class="icon flex flex-col justify-center button-menu_icon-wrap__foj7b"><span class="block"></span><span class="block"></span><span class="block"></span></span></button></div><div class="hidden"><nav><ul class="main-menu lg:flex justify-end items-baseline main_wrap__NyemA"></ul></nav><div class="lg:flex justify-end mt-8 pt-4 lg:mt-0 lg:pt-0 border-t border-white lg:border-0 lg:mb-2"><nav class="header-secondary"><ul class="flex lg:block justify-around mb-5 lg:mb-0"><li class="lg:ml-9 inline-block hover:underline"><a class="link--secondary capitalize text-menu-sm font-semibold lg:mb-3" href="/partners">Partners</a></li><li class="lg:ml-9 inline-block hover:underline"><a class="link--secondary capitalize text-menu-sm font-semibold lg:mb-3" target="_blank" rel="noopener" href="https://portal.deepinstinct.com">Login</a></li></ul></nav><nav class="language-switcher lg:ml-9"><ul></ul></nav></div></div></div></div><div data-focus-guard="true" tabindex="-1" style="width:1px;height:0px;padding:0;overflow:hidden;position:fixed;top:1px;left:1px"></div></div></header><main role="main"><div class="blog-content BlogContent_blog-content___t6DI"><div class="blog-header"><div class="blog-header__image relative"><div class="absolute left-0 top-0 w-full h-4/5 bg-blue"></div><div class="container mx-auto"><div class="blog-header__image max-w-blog w-full mx-auto relative z-1 pt-9 mb-12"><a class="inline-block font-bold uppercase text-cta tracking-widder undefined button_btn--link__eEiq4 undefined button_btn--arrow-left__1tBOJ undefined button_btn--arrow-left-blue__MX_w9 px-3.5 py-4 absolute left-0 z-1 uppercase !tracking-widest hover:underline bg-yellow text-blue BlogHeader_blog-header__back__HbkmP" href="/blog">Back To Blog<i class="button_btn__icon__luCR1"></i></a><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:43.01075268817204%"></span><img alt="" title="" aria-hidden="true" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="" title="" aria-hidden="true" sizes="100vw" srcSet="/_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=640&amp;q=100 640w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=768&amp;q=100 768w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=1024&amp;q=100 1024w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=1200&amp;q=100 1200w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=1400&amp;q=100 1400w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=1680&amp;q=100 1680w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=1920&amp;q=100 1920w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=2048&amp;q=100 2048w, /_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=3840&amp;q=100 3840w" src="/_next/image?url=https%3A%2F%2Fwww.deepinstinct.com%2Fimage%2Fbltd8c463dc3a603391%2F645bdd954ebc818bac33eac7%2Fblog-image-bpfdoor-malware.jpg&amp;w=3840&amp;q=100" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></div></div><div class="blog-header__content container mx-auto mb-12"><div class="max-w-blog w-full mx-auto pb-9 border-b-2 border-grey"><div class="flex justify-between mb-12"><div class="font-sans font-bold text-sm tracking-widest pt-2">MAY 10, 2023</div><div class="social-share SocialShare_social-share__eXoQ_"><button aria-label="linkedin" class="react-share__ShareButton social-share__btn linkedin hover:opacity-80" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"></button><button aria-label="twitter" class="react-share__ShareButton social-share__btn twitter hover:opacity-80" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"></button><button aria-label="facebook" class="react-share__ShareButton social-share__btn facebook hover:opacity-80" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"></button></div></div><h1 class="text-h-md lg:text-h-lg mb-6">BPFDoor Malware Evolves – Stealthy Sniffing Backdoor Ups Its Game</h1><div class="blog-header__author mt-7 md:grid md:gap-4 md:grid-cols-3"><div class="mb-3 md:mb-0"><a class="author-teaser hover:underline AuthorTeaser_author-teaser__xETTr" href="/author/shaul-vilkomir-preisman"><span class="author-teaser__image block"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2760%27%20height=%2760%27/%3e"/></span><img alt="Shaul Vilkomir-Preisman" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full overflow-hidden" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Shaul Vilkomir-Preisman" srcSet="/_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fblt27582526dae93901%2F63053a0dc2bcbf7e7232710b%2Fvilkomir-preisman_shaul.png&amp;w=64&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fblt27582526dae93901%2F63053a0dc2bcbf7e7232710b%2Fvilkomir-preisman_shaul.png&amp;w=128&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fblt27582526dae93901%2F63053a0dc2bcbf7e7232710b%2Fvilkomir-preisman_shaul.png&amp;w=128&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full overflow-hidden" loading="lazy"/></noscript></span></span><span class="author-teaser__content block text-m pt-2"><span class="font-semibold block">Shaul Vilkomir-Preisman</span><span class="block">Threat Intelligence Researcher</span></span></a></div><div class="mb-3 md:mb-0"><a class="author-teaser hover:underline AuthorTeaser_author-teaser__xETTr" href="/author/eliran-nissan"><span class="author-teaser__image block"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2760%27%20height=%2760%27/%3e"/></span><img alt="Eliran Nissan" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full overflow-hidden" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Eliran Nissan" srcSet="/_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fblt9c5dcf3ddd4b1feb%2F645d0d62e0f341774157a96b%2Feliran.jpg&amp;w=64&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fblt9c5dcf3ddd4b1feb%2F645d0d62e0f341774157a96b%2Feliran.jpg&amp;w=128&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fblt9c5dcf3ddd4b1feb%2F645d0d62e0f341774157a96b%2Feliran.jpg&amp;w=128&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full overflow-hidden" loading="lazy"/></noscript></span></span><span class="author-teaser__content block text-m pt-2"><span class="font-semibold block">Eliran Nissan</span><span class="block">Security Researcher</span></span></a></div><div class="mb-3 md:mb-0"><a class="author-teaser hover:underline AuthorTeaser_author-teaser__xETTr" href="/author/deep-instinct-research"><span class="author-teaser__image block"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2760%27%20height=%2760%27/%3e"/></span><img alt="Deep Instinct Threat Lab" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full overflow-hidden" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Deep Instinct Threat Lab" srcSet="/_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fbltfdfca743f7ac9662%2F630e2d5d8bdc107d4a01ba3f%2F800x800-blue-monogram.png&amp;w=64&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fbltfdfca743f7ac9662%2F630e2d5d8bdc107d4a01ba3f%2F800x800-blue-monogram.png&amp;w=128&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fimages.contentstack.io%2Fv3%2Fassets%2Fblt1ec077b6b53d6b3e%2Fbltfdfca743f7ac9662%2F630e2d5d8bdc107d4a01ba3f%2F800x800-blue-monogram.png&amp;w=128&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full overflow-hidden" loading="lazy"/></noscript></span></span><span class="author-teaser__content block text-m pt-2"><span class="font-semibold block">Deep Instinct Threat Lab</span></span></a></div></div></div></div></div><div class="text-block container--full"><div class="container mx-auto relative mb-6 lg:mb-10 overflow-hidden"><div class="max-w-blog w-full mx-auto TextBlock_text__Bt8_5"><div class="paragraph-item"><h5>What is BPFdoor?</h5><p>BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise.</p><p>The malware gets its name from its usage of a <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter" target="_blank" rel="noopener">Berkley Packet Filter</a> – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic.</p><p>The malware is associated with a Chinese threat actor, Red Menshen (AKA Red Dev 18), which has been observed targeting telecommunications providers across the Middle East and Asia, as well as entities in the government, education, and logistics sectors since 2021.</p><p>When it was first discovered, approximately one year ago, BPFdoor was noted for its effective and elegant design and its high emphasis on stealth – an essential element in maintaining undetected long-term persistence.</p><p>Recently, Deep Instinct’s threat lab observed and analyzed a previously undocumented and fully undetected new variant of BPFdoor.</p><h5>New, Stealthier Variant</h5><p>Several key differences that make this new variant even stealthier compared to the previous version include the following:</p><p></p><p></p><table class="text-center"><thead class="bg-grey"><tr><th style="width:24%"> </th><th style="width:38%">“New stealthy” 2023 variant</th><th>“Old” 2022 variant</th></tr></thead><tbody><tr><td><p>Encryption</p></td><td><p>Static library encryption</p></td><td><p>RC4 Encryption</p></td></tr><tr><td><p>Communication</p></td><td><p>Reverse-Shell</p></td><td><p>Bind shell and iptables</p></td></tr><tr><td><p>Commands</p></td><td><p>No hardcoded commands – all commands are sent through the reverse-shell</p></td><td><p>Hardcoded commands</p></td></tr><tr><td><p>Filenames</p></td><td><p>Not hardcoded</p></td><td><p>Hardcoded</p></td></tr></tbody></table><p></p><p>One of the most significant differences compared to the previous variant lies in the removal of many of its hardcoded indicators, making the newer version more difficult to detect. Since first seen on VirusTotal in February 2023, the new variant remained undetected and is still undetected as of this writing.</p><h5>BPFdoor Technical Analysis</h5><p>When executed, the BPFdoor sample will attempt to create and get a lock on a runtime file at <em>“/var/run/initd.lock”</em> and will exit if it fails using that file as a makeshift mutex.</p><p></p><figure><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt6b1f7a605acf0d71" alt="Figure 1 - BPFdoor " src="https://www.deepinstinct.com/image/blt6b1f7a605acf0d71/645bce382f97ad6087afc2a7/fig01-lock-mutex.png" style="text-align:center"/><figcaption style="text-align:center">Figure 1 - BPFdoor &quot;mutex&quot; check</figcaption></figure></figure><p></p><p>If successful, BPFdoor will fork itself and continue to run as a child process and in this context will close its <em>stdin</em>, <em>stdout</em>, and <em>stderr</em> streams, and set itself to ignore the following operating system signals:</p><p></p><table class="text-center"><thead class="bg-grey"><tr><th style="width:16%">Signal Number</th><th style="width:21%">Signal Name</th><th>Signal Description</th></tr></thead><tbody><tr><td><p>1</p></td><td><p>SIGHUP</p></td><td><p>SIGHUP (&quot;signal hang-up&quot;) is a signal sent to a process when its controlling terminal session is closed.</p></td></tr><tr><td><p>2</p></td><td><p>SIGINT</p></td><td><p>SIGINT (“signal interrupt”) is a signal sent when a user interrupts a program (Ctrl + C)</p></td></tr><tr><td><p>3</p></td><td><p>SIGQUIT</p></td><td><p>SIGQUIT is a signal sent to terminate a process.</p></td></tr><tr><td><p>13</p></td><td><p>SIGPIPE</p></td><td><p>SIGPIPE is a signal sent when a pipe breaks.</p></td></tr><tr><td><p>17</p></td><td><p>SIGCHLD</p></td><td><p>SIGCHLD is a signal sent when a child process exits.</p></td></tr><tr><td><p>21</p></td><td><p>SIGTTIN</p></td><td><p>SIGTTIN is a signal sent to a process attempting to read from the same terminal session and is blocked.</p></td></tr><tr><td><p>23</p></td><td><p>SIGTTOU</p></td><td><p>SIGTTOU is a signal sent to a process attempting to write to the same terminal session and is blocked.</p></td></tr></tbody></table><p></p><p>Ignoring these signals hardens BPFdoor against tampering with its processes.</p><p>Having set up the above, BPFdoor then allocates a memory buffer and creates a socket as follows:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="bltb66f26dd618af2fe" alt="Figure 2 - Socket arguments" src="https://www.deepinstinct.com/image/bltb66f26dd618af2fe/645bce386d595aca93fa2ebf/fig02-socket-args.png" style="text-align:center"/><figcaption style="text-align:center">Figure 2 - Socket arguments</figcaption></figure><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blte9215556a7459197" alt="Figure 3 - Socket creation" src="https://www.deepinstinct.com/image/blte9215556a7459197/645bce388a8445ca97101283/fig03-call-socket.png" style="text-align:center"/><figcaption style="text-align:center">Figure 3 - Socket creation</figcaption></figure><p></p><p>It will proceed to specify the following socket options using setsockopt:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="bltff07360ec7be9930" alt="Figure 4 - Setsockopt options" src="https://www.deepinstinct.com/image/bltff07360ec7be9930/645bce388dbb82c3c233f5f4/fig04-setsockopts.png" style="text-align:center"/><figcaption style="text-align:center">Figure 4 - Setsockopt options</figcaption></figure><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt0e81a161934c6431" alt="Figure 5 - Call to setsockopt" src="https://www.deepinstinct.com/image/blt0e81a161934c6431/645bce38e4e69e5cbc037449/fig05-call-setsockopts.png" style="text-align:center"/><figcaption style="text-align:center">Figure 5 - Call to setsockopt</figcaption></figure><p></p><p>And will read from it in a loop (further described below) using recvfrom:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt7a59c922701ee083" alt="Figure 6 - Recvfrom arguments" src="https://www.deepinstinct.com/image/blt7a59c922701ee083/645bce38065c95739056107a/fig06-recvfrom.png" style="text-align:center"/><figcaption style="text-align:center">Figure 6 - Recvfrom arguments</figcaption></figure><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt811bbcab6a1bb954" alt="Figure 7 - Recvfrom call" src="https://www.deepinstinct.com/image/blt811bbcab6a1bb954/645bce38367cefb5428f68a2/fig07-loop-call-recvfrom.png" style="text-align:center"/><figcaption style="text-align:center">Figure 7 - Recvfrom call</figcaption></figure><p></p><p>An interesting point in the above-described flow is that the <em>“addr”</em> parameter is zeroed out in the call to <em>recvfrom</em>; it should point to a specific address from which to read data. The socket is not connected and no bind or listen calls have been made. So, what exactly is going on here?</p><p>Interpreting the exact arguments that are used to create the socket reveals that the call is structured as follows:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt36f6534323294019" alt="Figure 8 - Socket call" src="https://www.deepinstinct.com/image/blt36f6534323294019/645bce38367cefe17b8f689e/fig08-socket_eth.png" style="text-align:center"/><figcaption style="text-align:center">Figure 8 - Socket call</figcaption></figure><p></p><p>This creates the socket as a special packet sniffing socket which is able to read every packet that is sent to the machine from the ethernet layer and above without being bound to any specific protocol.</p><p>BPFdoor employs this type of packet sniffing socket to read data with <em>recvfrom</em>, even without an <em>“addr”</em> parameter, by using the loop below to search for a specific “magic” byte sequence:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="bltf3c3312b0751a812" alt="Figure 9 - Looped search for " src="https://www.deepinstinct.com/image/bltf3c3312b0751a812/645bce388929af83080777c5/fig09-read-loop.png" style="text-align:center"/><figcaption style="text-align:center">Figure 9 - Looped search for &quot;magic&quot; byte sequence (highlighted)</figcaption></figure><p></p><p>“Magic” byte sequence: <strong>\x44\x30\xCD\x9F\x5E\x14\x27\x66</strong></p><p>Once found, the loop will break and BPFdoor will continue to Its next phase of operation.</p><p>But, that creates quite a lot of traffic that BPFdoor will need to go through.</p><p>Let’s examine the usage of setsockopt a bit further. When parsing its arguments, we arrive at the following code:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt734c1601420f27c9" alt="Figure 10 - Setsockopt attaches BPF" src="https://www.deepinstinct.com/image/blt734c1601420f27c9/645bce4b7e7e7b9bafe70a08/fig10-setsockopt-args.png" style="text-align:center"/><figcaption style="text-align:center">Figure 10 - Setsockopt attaches BPF</figcaption></figure><p></p><p>This is where BPFdoor gets its name from. The above code that attaches a <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter" target="_blank" rel="noopener">Berkley Packet Filter</a> to the socket; this is the very same mechanism that underpins infosec staples such as libpcap and allows BPFdoor to filter out “uninteresting” types of data coming through its socket.</p><p>A Berkley Packet Filter can be defined as in the example below, which allows TCP over IPv4:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt89210974b140db77" alt="Figure 11 - BPF example" src="https://www.deepinstinct.com/image/blt89210974b140db77/645bce4b065c95264056107e/fig11-bpf-example.png" style="text-align:center"/><figcaption style="text-align:center">Figure 11 - BPF example</figcaption></figure><p></p><p>By setting the socket option SO_ATTACH_FILTER and pointing filter to the following sock_filter_code:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt3a9b0cf5b5fbc758" alt="Figure 12 - BPF sock_filter_code" src="https://www.deepinstinct.com/image/blt3a9b0cf5b5fbc758/645bce4b1f0a4c5876e36beb/fig12-sock-filter-codev3.png" style="text-align:center"/><figcaption style="text-align:center">Figure 12 - BPF sock_filter_code</figcaption></figure><p></p><p>BPFdoor guides the kernel to set up its socket to only read UDP, TCP, and SCTP traffic coming through ports 22 (ssh), 80 (http), and 443 (https).</p><p>Because of its positioning at such a low level, BPFdoor does not abide by any firewall rules, and can bypass any firewall restrictions on incoming traffic and listen for packets that otherwise wouldn&#x27;t have surfaced to the machine&#x27;s user mode.</p><p>When BPFdoor finds a packet containing its “magic” bytes in the filtered traffic it will treat it as a message from its operator and will parse out two fields and will again fork itself.</p><p>The parent process will continue and monitor the filtered traffic coming through the socket while the child will treat the previously parsed fields as a Command &amp; Control IP-Port combination and will attempt to contact it.</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt59a3decfdb9a8b40" alt="Figure 13 - Connect to Command &amp; Control" src="https://www.deepinstinct.com/image/blt59a3decfdb9a8b40/645bce4b8a84453a7a101287/fig13-connect-c2.png" style="text-align:center"/><figcaption style="text-align:center">Figure 13 - Connect to Command &amp; Control</figcaption></figure><p></p><p>An interesting point to note, this variant of BPFdoor contains a pre-compiled version of <a href="https://github.com/libtom/libtomcrypt" target="_blank" rel="noopener">libtomcrypt</a>, an open-source encryption library, as can be seen in the sample’s contained strings, which also offer a few additional insights:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt8e6c0a33246bf7b3" alt="Figure 14 - Contained strings" src="https://www.deepinstinct.com/image/blt8e6c0a33246bf7b3/645bce4b291ca448ab7458bf/fig14-libtom-strings.png" style="text-align:center"/><figcaption style="text-align:center">Figure 14 - Contained strings</figcaption></figure><p></p><p>We can see that the library was compiled at the beginning of October 2022 using GCC on a system running Red Hat Linux. This may suggest that this variant has been operational significantly earlier than its first appearance on VirusTotal.</p><p>By compiling our own version of the library in similar fashion and using <em>bindiff</em> to compare against BPFdoor we can see its statically linked exports:</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt816a0cb45cfa1a28" alt="Figure 15 - Libtomcrypt bindiff snippet" src="https://www.deepinstinct.com/image/blt816a0cb45cfa1a28/645bce4b2f97ad7a76afc2ab/fig15-libtom-bindiff.png" style="text-align:center"/><figcaption style="text-align:center">Figure 15 - Libtomcrypt bindiff snippet</figcaption></figure><p></p><p>Having made the comparison, we determined that BPFdoor is using libtomcrypt functionality to set up a secure and encrypted “reverse-shell” session with its Command &amp; Control. This replaced its previous mechanism.</p><p>After this session is established, BPFdoor will begin a loop that can be described by the following:</p><p></p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="bltb2ff1c169f93cb84" src="https://www.deepinstinct.com/image/bltb2ff1c169f93cb84/645bce3822f9986ff5c5974b/BPFDOORv2Flow.png" style="text-align:center"/></figure><p></p><h5>Conclusion</h5><p>BPFdoor retains its reputation as an extremely stealthy and difficult-to-detect malware with this latest iteration.</p><p>Regardless of whether one considers the encryption library compilation time (October 2022) or its initial submission to VirusTotal (February 2023) as indicative of when this sample was first put into use, it is truly amazing how long it has remained fully undetected.</p><p></p><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt93ffef0dee975742" src="https://www.deepinstinct.com/image/blt93ffef0dee975742/645d25159c40aa50cb074137/fig16-vt-0detectionv3.png" style="text-align:center"/></figure><figure style="margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;text-align:center;width:auto"><img asset_uid="blt940800074dbf8141" alt="Figure 16 &amp; 17 - 0 VirusTotal detections, 7 different scans." src="https://www.deepinstinct.com/image/blt940800074dbf8141/645bce4b32acc8af715ee19b/fig17-vt-many-scans.png" style="text-align:center"/><figcaption style="text-align:center">Figure 16 &amp; 17 - 0 VirusTotal detections, 7 different scans.</figcaption></figure><p></p><p></p><h5>IOCs</h5><p>afa8a32ec29a31f152ba20a30eb483520fe50f2dce6c9aa9135d88f7c9c511d7 – BPFDoor ELF SHA256<br/>/var/run/initd.lock – BPFDoor &quot;mutex”</p><p></p><p></p><h5>MITRE ATT&amp;CK:</h5><p></p><table class="text-center"><thead class="bg-grey"><tr><th style="width:20%">Tactic</th><th>Technique</th><th>Description</th><th style="width:20%">Observable</th></tr></thead><tbody><tr><td><p>Command and Control<br/>Defense Evasion<br/>Persistence</p></td><td><p>T1205 - Traffic Signaling</p></td><td><p>Attacker employs “magic” values to trigger response.</p></td><td><p>“Magic” byte sequence</p></td></tr><tr><td><p>Command and Control<br/>Defense Evasion<br/>Persistence</p></td><td><p>T1205.002 - Traffic Signaling: Socket Filters</p></td><td><p>Attacker attaches filter to a network socket.</p></td><td><p>Usage of Berkley Packet Filter</p></td></tr><tr><td><p>Command and Control</p></td><td><p>T1573 - Encrypted Channel</p></td><td><p>Attacker employs encrypted Command &amp; Control communication.</p></td><td><p>Usage of libtomcrypt</p></td></tr><tr><td><p>Execution</p></td><td><p>T1106 – Native API</p></td><td><p>Attacker calls upon native OS APIs in order to execute behaviors.</p></td><td><p>Usage of popen</p></td></tr></tbody></table><p></p><p><strong>Earlier variant analysis</strong>:<br/><a href="https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor" target="_blank" rel="noopener">https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor</a></p><p></p><p>Deep Instinct takes a prevention-first approach to stopping ransomware and other malware using the world’s first and only purpose-built, deep learning cybersecurity framework. We prevent ransomware, zero-day threats, and previously unknown malware in &lt;20 milliseconds, 750x faster than the fastest ransomware can encrypt. Deep Instinct has &gt;99% zero-day accuracy and promises a &lt;0.1% false positive rate. The Deep Instinct Prevention Platform is an essential addition to every security stack – providing complete, multi-layered protection against threats across hybrid environments.</p><p></p><p></p></div></div></div></div><div class="back-page container mx-auto"><div class="max-w-blog w-full mx-auto pt-9 border-t-2 border-blue"><div class="flex justify-between mb-12 md:mb-16"><a class="inline-block font-bold uppercase text-cta tracking-widder undefined button_btn--link__eEiq4 undefined button_btn--arrow-left__1tBOJ undefined button_btn--arrow-left-blue__MX_w9 hover:underline mt-2" href="/blog">Back To Blog<i class="button_btn__icon__luCR1"></i></a><div class="social-share SocialShare_social-share__eXoQ_"><button aria-label="linkedin" class="react-share__ShareButton social-share__btn linkedin hover:opacity-80" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"></button><button aria-label="twitter" class="react-share__ShareButton social-share__btn twitter hover:opacity-80" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"></button><button aria-label="facebook" class="react-share__ShareButton social-share__btn facebook hover:opacity-80" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"></button></div></div></div></div></div></main><footer class="Footer_footer__Dhw_9 bg-blue-dark text-white py-10"><div class="container--full"><div class="container mx-auto"><div class="footer__top"><div class="footer__menus grid grid-cols-1 gap-0 lg:grid-cols-4 lg:gap-4 2xl:grid-cols-5 mb-4"><div class="footer__logo mb-10"><a class="text-white" href="/"></a></div><div class="grid grid-cols-2 md:grid-cols-3 gap-4 lg:col-span-3 2xl:col-span-4 2xl:grid-cols-4"><div class="footer__menu"><div class="mb-5"><h3 class="text-sm uppercase font-sans tracking-widest font-bold mb-4"><span class="Footer_footer__border-bottom__pvw5Q">Products</span></h3><ul><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Prevention Platform" href="/platform">Prevention Platform</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Prevention for Applications" href="/prevention-for-applications">Prevention for Applications</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Prevention for Endpoints" href="/endpoint-security">Prevention for Endpoints</a></li></ul></div></div><div class="footer__menu"><div class="mb-5"><h3 class="text-sm uppercase font-sans tracking-widest font-bold mb-4"><span class="Footer_footer__border-bottom__pvw5Q">Solutions</span></h3><ul><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Prevent Ransomware" href="/ransomware-protection-solution">Prevent Ransomware</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Prevent Zero-Day Attacks" href="/zero-day-attacks">Prevent Zero-Day Attacks</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Improve EPP Efficacy" href="/endpoint-protection-platforms">Improve EPP Efficacy</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Extend &amp; Enhance EDR" href="/endpoint-detection-response">Extend &amp; Enhance EDR</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Stop Fileless Attacks" href="/prevent-fileless-malware">Stop Fileless Attacks</a></li></ul></div></div><div class="footer__menu"><div class="mb-5"><h3 class="text-sm uppercase font-sans tracking-widest font-bold mb-4"><span class="Footer_footer__border-bottom__pvw5Q">Why Deep Instinct</span></h3><ul><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Deep Learning in Cybersecurity" href="/why-deep-instinct">Deep Learning in Cybersecurity</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Our Customers" href="/customers">Our Customers</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="+ MS Defender" href="/vs-microsoft-defender">+ MS Defender</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="VS Traditional Antivirus" href="/deep-instinct-vs-competitors">VS Traditional Antivirus</a></li></ul></div></div><div class="footer__menu"><div class="mb-5"><h3 class="text-sm uppercase font-sans tracking-widest font-bold mb-4"><span class="Footer_footer__border-bottom__pvw5Q">Company</span></h3><ul><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="About Deep Instinct" href="/about-us">About Deep Instinct</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Newsroom" href="/newsroom">Newsroom</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Careers" href="/careers">Careers</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Contact Us" href="/contact-us">Contact Us</a></li></ul></div></div><div class="footer__menu"><div class="mb-5"><h3 class="text-sm uppercase font-sans tracking-widest font-bold mb-4"><span class="Footer_footer__border-bottom__pvw5Q">Resources</span></h3><ul><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Asset Library" href="/resources">Asset Library</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Blog" href="/blog">Blog</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Videos" href="/videos">Videos</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Training" href="/deep-instinct-training">Training</a></li></ul></div></div><div class="footer__menu"><div class="mb-5"><h3 class="text-sm uppercase font-sans tracking-widest font-bold mb-4"><span class="Footer_footer__border-bottom__pvw5Q">Quick links</span></h3><ul><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Request Demo" href="/request-a-demo">Request Demo</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Customer Portal" target="_blank" rel="noopener" href="https://portal.deepinstinct.com/">Customer Portal</a></li><li><a class="text-sm tracking-wide Footer_footer__border-bottom__pvw5Q" aria-label="Integrations and Compliance" href="/compliance-certification-evaluation">Integrations and Compliance</a></li></ul></div></div></div></div></div><div class="footer__bottom border-t border-grey py-2 pt-9 grid grid-cols-1 md:grid-cols-5 xl:grid-cols-4"><div class="footer__copyright order-3 md:col-span-2 md:order-2 xl:col-span-1 xl:order-1 flex items-center"><p class="font-medium text-h-xs tracking-wide-sm">© <!-- -->2023<!-- --> Deep Instinct. All rights reserved.</p></div><div class="footer__more text-left col-span-1 order-2 py-4 md:py-0 md:col-span-3 md:text-right md:order-3 xl:order-2 xl:text-center xl:col-span-2"><ul><li class="block px-0 md:inline-block md:px-5 "><a class="text-sm tracking-wide-sm font-medium Footer_footer__border-bottom__pvw5Q" aria-label="Privacy Policy" href="/privacy-policy">Privacy Policy</a></li><li class="block px-0 md:inline-block md:px-5 md:pr-0 xl:pr-5"><a class="text-sm tracking-wide-sm font-medium Footer_footer__border-bottom__pvw5Q" aria-label="Terms of use" href="/terms-of-use">Terms of use</a></li></ul></div><div class="footer__social text-center order-1 md:col-span-5 md:order-1 md:mb-4 xl:mb-0 xl:order-3 xl:text-right xl:col-span-1"><ul class="flex justify-center xl:justify-end"><li class="flex items-center h-6"><a href="https://www.youtube.com/channel/UCYerfisJf3hc9QOWmic1G9Q" aria-label="Find us on youtube" class="inline-block px-3 hover:opacity-80 " target="_blank" rel="noopener"></a></li><li class="flex items-center h-6"><a href="https://www.linkedin.com/company/deep-instinct" aria-label="Find us on linkedin" class="inline-block px-3 hover:opacity-80 " target="_blank" rel="noopener"></a></li><li class="flex items-center h-6"><a href="https://twitter.com/DeepInstinctSec" aria-label="Find us on twitter" class="inline-block px-3 hover:opacity-80 " target="_blank" rel="noopener"></a></li><li class="flex items-center h-6"><a href="https://www.facebook.com/DeepInstinctInc" aria-label="Find us on facebook" class="inline-block px-3 hover:opacity-80 xl:pr-0" target="_blank" rel="noopener"></a></li></ul></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blockPost":{"_version":8,"locale":"en-us","uid":"blta889e81ad2401e4a","ACL":{},"_in_progress":false,"author":[{"_content_type_uid":"di_author","_version":3,"locale":"en-us","uid":"blt786b6230d0ad1dfa","ACL":{},"_in_progress":false,"author_title":"Threat Intelligence Researcher","bio":"","created_at":"2021-09-14T09:13:30.916Z","created_by":"blt1d5768f5c3f56b45","image":{"parent_uid":"blt9a4786940a2a3a18","uid":"blt27582526dae93901","created_by":"blt0d598b36a82e8d10","updated_by":"blt0d598b36a82e8d10","created_at":"2022-08-23T20:35:25.799Z","updated_at":"2022-08-23T20:35:25.799Z","content_type":"image/png","file_size":"1018054","filename":"vilkomir-preisman_shaul.png","title":"vilkomir-preisman_shaul.png","ACL":{},"_version":1,"is_dir":false,"tags":[],"publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2022-08-25T18:44:39.133Z","user":"blt0d598b36a82e8d10"},"url":"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt27582526dae93901/63053a0dc2bcbf7e7232710b/vilkomir-preisman_shaul.png"},"tags":[],"title":"Shaul Vilkomir-Preisman","updated_at":"2022-08-23T20:35:59.752Z","updated_by":"blt0d598b36a82e8d10","url":"/shaul-vilkomir-preisman","publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2022-08-25T18:44:39.159Z","user":"blt0d598b36a82e8d10"}},{"_content_type_uid":"di_author","_version":2,"locale":"en-us","uid":"blta82583ad0361ca56","ACL":{},"_in_progress":false,"author_title":"Security Researcher","bio":"","created_at":"2023-04-10T18:36:31.047Z","created_by":"bltc9f76683df0aaacc","image":{"parent_uid":"blt9a4786940a2a3a18","uid":"blt9c5dcf3ddd4b1feb","created_by":"bltc9f76683df0aaacc","updated_by":"bltc9f76683df0aaacc","created_at":"2023-05-11T15:44:34.428Z","updated_at":"2023-05-11T15:44:34.428Z","content_type":"image/jpeg","file_size":"364991","filename":"eliran.jpg","title":"eliran.jpg","ACL":{},"_version":1,"is_dir":false,"tags":[],"publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2023-05-11T15:44:45.947Z","user":"bltc9f76683df0aaacc"},"url":"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt9c5dcf3ddd4b1feb/645d0d62e0f341774157a96b/eliran.jpg"},"social_links":[],"tags":[],"title":"Eliran Nissan","updated_at":"2023-05-11T15:44:40.362Z","updated_by":"bltc9f76683df0aaacc","url":"/eliran-nissan","publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2023-05-11T15:44:45.973Z","user":"bltc9f76683df0aaacc"}},{"_content_type_uid":"di_author","_version":4,"locale":"en-us","uid":"bltf2f2c4ed0c1268e0","ACL":{},"_in_progress":false,"author_title":"","bio":"","created_at":"2021-09-14T09:13:32.660Z","created_by":"blt1d5768f5c3f56b45","image":{"parent_uid":"blt9a4786940a2a3a18","uid":"bltfdfca743f7ac9662","created_by":"blt0d598b36a82e8d10","updated_by":"blt0d598b36a82e8d10","created_at":"2022-08-30T15:03:33.619Z","updated_at":"2022-08-30T15:31:41.534Z","content_type":"image/png","file_size":"6122","filename":"800x800-blue-monogram.png","title":"800x800-blue-monogram.png","ACL":{},"_version":4,"is_dir":false,"tags":[],"description":"","publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2022-08-30T15:33:02.498Z","user":"blt0d598b36a82e8d10"},"url":"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltfdfca743f7ac9662/630e2d5d8bdc107d4a01ba3f/800x800-blue-monogram.png"},"social_links":[],"tags":[],"title":"Deep Instinct Threat Lab","updated_at":"2022-08-30T15:32:56.174Z","updated_by":"blt0d598b36a82e8d10","url":"/deep-instinct-research","publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2022-08-30T15:33:02.549Z","user":"blt0d598b36a82e8d10"}}],"created_at":"2023-05-10T17:35:44.688Z","created_by":"bltc9f76683df0aaacc","description":"","di_tags":[],"image":{"src":"https://www.deepinstinct.com/image/bltd8c463dc3a603391/645bdd954ebc818bac33eac7/blog-image-bpfdoor-malware.jpg","alt":"","title":"","meta":{"type":"image","uid":"bltd8c463dc3a603391","locale":"en-us"},"width":930,"height":400},"modular_blocks":[{"richtext_block":{"rich_text_editor":"\u003ch5\u003eWhat is BPFdoor?\u003c/h5\u003e\u003cp\u003eBPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise.\u003c/p\u003e\u003cp\u003eThe malware gets its name from its usage of a \u003ca href=\"https://en.wikipedia.org/wiki/Berkeley_Packet_Filter\" target=\"_blank\"\u003eBerkley Packet Filter\u003c/a\u003e – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic.\u003c/p\u003e\u003cp\u003eThe malware is associated with a Chinese threat actor, Red Menshen (AKA Red Dev 18), which has been observed targeting telecommunications providers across the Middle East and Asia, as well as entities in the government, education, and logistics sectors since 2021.\u003c/p\u003e\u003cp\u003eWhen it was first discovered, approximately one year ago, BPFdoor was noted for its effective and elegant design and its high emphasis on stealth – an essential element in maintaining undetected long-term persistence.\u003c/p\u003e\u003cp\u003eRecently, Deep Instinct’s threat lab observed and analyzed a previously undocumented and fully undetected new variant of BPFdoor.\u003c/p\u003e\u003ch5\u003eNew, Stealthier Variant\u003c/h5\u003e\u003cp\u003eSeveral key differences that make this new variant even stealthier compared to the previous version include the following:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ctable class=\"text-center\"\u003e\u003cthead class=\"bg-grey\"\u003e\u003ctr\u003e\u003cth style=\"width: 24%;\"\u003e\u0026nbsp;\u003c/th\u003e\u003cth style=\"width: 38%;\"\u003e“New stealthy” 2023 variant\u003c/th\u003e\u003cth\u003e“Old” 2022 variant\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eEncryption\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eStatic library encryption\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eRC4 Encryption\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommunication\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eReverse-Shell\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eBind shell and iptables\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommands\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eNo hardcoded commands – all commands are sent through the reverse-shell\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eHardcoded commands\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eFilenames\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eNot hardcoded\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eHardcoded\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eOne of the most significant differences compared to the previous variant lies in the removal of many of its hardcoded indicators, making the newer version more difficult to detect. Since first seen on VirusTotal in February 2023, the new variant remained undetected and is still undetected as of this writing.\u003c/p\u003e\u003ch5\u003eBPFdoor Technical Analysis\u003c/h5\u003e\u003cp\u003eWhen executed, the BPFdoor sample will attempt to create and get a lock on a runtime file at \u003cem\u003e“/var/run/initd.lock”\u003c/em\u003e and will exit if it fails using that file as a makeshift mutex.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt6b1f7a605acf0d71\" alt=\"Figure 1 - BPFdoor \" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt6b1f7a605acf0d71/645bce382f97ad6087afc2a7/fig01-lock-mutex.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 1 - BPFdoor \"mutex\" check\u003c/figcaption\u003e\u003c/figure\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eIf successful, BPFdoor will fork itself and continue to run as a child process and in this context will close its \u003cem\u003estdin\u003c/em\u003e, \u003cem\u003estdout\u003c/em\u003e, and \u003cem\u003estderr\u003c/em\u003e streams, and set itself to ignore the following operating system signals:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ctable class=\"text-center\"\u003e\u003cthead class=\"bg-grey\"\u003e\u003ctr\u003e\u003cth style=\"width: 16%;\"\u003eSignal Number\u003c/th\u003e\u003cth style=\"width: 21%;\"\u003eSignal Name\u003c/th\u003e\u003cth\u003eSignal Description\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e1\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGHUP\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGHUP (\"signal hang-up\") is a signal sent to a process when its controlling terminal session is closed.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e2\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGINT\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGINT (“signal interrupt”) is a signal sent when a user interrupts a program (Ctrl + C)\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e3\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGQUIT\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGQUIT is a signal sent to terminate a process.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e13\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGPIPE\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGPIPE is a signal sent when a pipe breaks.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e17\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGCHLD\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGCHLD is a signal sent when a child process exits.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e21\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTIN\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTIN is a signal sent to a process attempting to read from the same terminal session and is blocked.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e23\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTOU\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTOU is a signal sent to a process attempting to write to the same terminal session and is blocked.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eIgnoring these signals hardens BPFdoor against tampering with its processes.\u003c/p\u003e\u003cp\u003eHaving set up the above, BPFdoor then allocates a memory buffer and creates a socket as follows:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltb66f26dd618af2fe\" alt=\"Figure 2 - Socket arguments\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltb66f26dd618af2fe/645bce386d595aca93fa2ebf/fig02-socket-args.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 2 - Socket arguments\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blte9215556a7459197\" alt=\"Figure 3 - Socket creation\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blte9215556a7459197/645bce388a8445ca97101283/fig03-call-socket.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 3 - Socket creation\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eIt will proceed to specify the following socket options using setsockopt:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltff07360ec7be9930\" alt=\"Figure 4 - Setsockopt options\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltff07360ec7be9930/645bce388dbb82c3c233f5f4/fig04-setsockopts.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 4 - Setsockopt options\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt0e81a161934c6431\" alt=\"Figure 5 - Call to setsockopt\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt0e81a161934c6431/645bce38e4e69e5cbc037449/fig05-call-setsockopts.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 5 - Call to setsockopt\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eAnd will read from it in a loop (further described below) using recvfrom:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt7a59c922701ee083\" alt=\"Figure 6 - Recvfrom arguments\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt7a59c922701ee083/645bce38065c95739056107a/fig06-recvfrom.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 6 - Recvfrom arguments\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt811bbcab6a1bb954\" alt=\"Figure 7 - Recvfrom call\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt811bbcab6a1bb954/645bce38367cefb5428f68a2/fig07-loop-call-recvfrom.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 7 - Recvfrom call\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eAn interesting point in the above-described flow is that the \u003cem\u003e“addr”\u003c/em\u003e parameter is zeroed out in the call to \u003cem\u003erecvfrom\u003c/em\u003e; it should point to a specific address from which to read data. The socket is not connected and no bind or listen calls have been made. So, what exactly is going on here?\u003c/p\u003e\u003cp\u003eInterpreting the exact arguments that are used to create the socket reveals that the call is structured as follows:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt36f6534323294019\" alt=\"Figure 8 - Socket call\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt36f6534323294019/645bce38367cefe17b8f689e/fig08-socket_eth.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 8 - Socket call\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eThis creates the socket as a special packet sniffing socket which is able to read every packet that is sent to the machine from the ethernet layer and above without being bound to any specific protocol.\u003c/p\u003e\u003cp\u003eBPFdoor employs this type of packet sniffing socket to read data with \u003cem\u003erecvfrom\u003c/em\u003e, even without an \u003cem\u003e“addr”\u003c/em\u003e parameter, by using the loop below to search for a specific “magic” byte sequence:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltf3c3312b0751a812\" alt=\"Figure 9 - Looped search for \" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltf3c3312b0751a812/645bce388929af83080777c5/fig09-read-loop.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 9 - Looped search for \"magic\" byte sequence (highlighted)\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e“Magic” byte sequence: \u003cstrong\u003e\\x44\\x30\\xCD\\x9F\\x5E\\x14\\x27\\x66\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eOnce found, the loop will break and BPFdoor will continue to Its next phase of operation.\u003c/p\u003e\u003cp\u003eBut, that creates quite a lot of traffic that BPFdoor will need to go through.\u003c/p\u003e\u003cp\u003eLet’s examine the usage of setsockopt a bit further. When parsing its arguments, we arrive at the following code:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt734c1601420f27c9\" alt=\"Figure 10 - Setsockopt attaches BPF\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt734c1601420f27c9/645bce4b7e7e7b9bafe70a08/fig10-setsockopt-args.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 10 - Setsockopt attaches BPF\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eThis is where BPFdoor gets its name from. The above code that attaches a \u003ca href=\"https://en.wikipedia.org/wiki/Berkeley_Packet_Filter\" target=\"_blank\"\u003eBerkley Packet Filter\u003c/a\u003e to the socket; this is the very same mechanism that underpins infosec staples such as libpcap and allows BPFdoor to filter out “uninteresting” types of data coming through its socket.\u003c/p\u003e\u003cp\u003eA Berkley Packet Filter can be defined as in the example below, which allows TCP over IPv4:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt89210974b140db77\" alt=\"Figure 11 - BPF example\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt89210974b140db77/645bce4b065c95264056107e/fig11-bpf-example.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 11 - BPF example\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eBy setting the socket option SO_ATTACH_FILTER and pointing filter to the following sock_filter_code:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt3a9b0cf5b5fbc758\" alt=\"Figure 12 - BPF sock_filter_code\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt3a9b0cf5b5fbc758/645bce4b1f0a4c5876e36beb/fig12-sock-filter-codev3.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 12 - BPF sock_filter_code\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eBPFdoor guides the kernel to set up its socket to only read UDP, TCP, and SCTP traffic coming through ports 22 (ssh), 80 (http), and 443 (https).\u003c/p\u003e\u003cp\u003eBecause of its positioning at such a low level, BPFdoor does not abide by any firewall rules, and can bypass any firewall restrictions on incoming traffic and listen for packets that otherwise wouldn't have surfaced to the machine's user mode.\u003c/p\u003e\u003cp\u003eWhen BPFdoor finds a packet containing its “magic” bytes in the filtered traffic it will treat it as a message from its operator and will parse out two fields and will again fork itself.\u003c/p\u003e\u003cp\u003eThe parent process will continue and monitor the filtered traffic coming through the socket while the child will treat the previously parsed fields as a Command \u0026 Control IP-Port combination and will attempt to contact it.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt59a3decfdb9a8b40\" alt=\"Figure 13 - Connect to Command \u0026 Control\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt59a3decfdb9a8b40/645bce4b8a84453a7a101287/fig13-connect-c2.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 13 - Connect to Command \u0026 Control\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eAn interesting point to note, this variant of BPFdoor contains a pre-compiled version of \u003ca href=\"https://github.com/libtom/libtomcrypt\" target=\"_blank\"\u003elibtomcrypt\u003c/a\u003e, an open-source encryption library, as can be seen in the sample’s contained strings, which also offer a few additional insights:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt8e6c0a33246bf7b3\" alt=\"Figure 14 - Contained strings\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt8e6c0a33246bf7b3/645bce4b291ca448ab7458bf/fig14-libtom-strings.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 14 - Contained strings\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eWe can see that the library was compiled at the beginning of October 2022 using GCC on a system running Red Hat Linux. This may suggest that this variant has been operational significantly earlier than its first appearance on VirusTotal.\u003c/p\u003e\u003cp\u003eBy compiling our own version of the library in similar fashion and using \u003cem\u003ebindiff\u003c/em\u003e to compare against BPFdoor we can see its statically linked exports:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt816a0cb45cfa1a28\" alt=\"Figure 15 - Libtomcrypt bindiff snippet\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt816a0cb45cfa1a28/645bce4b2f97ad7a76afc2ab/fig15-libtom-bindiff.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 15 - Libtomcrypt bindiff snippet\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eHaving made the comparison, we determined that BPFdoor is using libtomcrypt functionality to set up a secure and encrypted “reverse-shell” session with its Command \u0026 Control. This replaced its previous mechanism.\u003c/p\u003e\u003cp\u003eAfter this session is established, BPFdoor will begin a loop that can be described by the following:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltb2ff1c169f93cb84\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltb2ff1c169f93cb84/645bce3822f9986ff5c5974b/BPFDOORv2Flow.png\" style=\"text-align: center;\"/\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003ch5\u003eConclusion\u003c/h5\u003e\u003cp\u003eBPFdoor retains its reputation as an extremely stealthy and difficult-to-detect malware with this latest iteration.\u003c/p\u003e\u003cp\u003eRegardless of whether one considers the encryption library compilation time (October 2022) or its initial submission to VirusTotal (February 2023) as indicative of when this sample was first put into use, it is truly amazing how long it has remained fully undetected.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt93ffef0dee975742\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt93ffef0dee975742/645d25159c40aa50cb074137/fig16-vt-0detectionv3.png\" style=\"text-align: center;\"/\u003e\u003c/figure\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt940800074dbf8141\" alt=\"Figure 16 \u0026 17 - 0 VirusTotal detections, 7 different scans.\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt940800074dbf8141/645bce4b32acc8af715ee19b/fig17-vt-many-scans.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 16 \u0026 17 - 0 VirusTotal detections, 7 different scans.\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ch5\u003eIOCs\u003c/h5\u003e\u003cp\u003eafa8a32ec29a31f152ba20a30eb483520fe50f2dce6c9aa9135d88f7c9c511d7 – BPFDoor ELF SHA256\u003cbr/\u003e/var/run/initd.lock – BPFDoor \"mutex”\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ch5\u003eMITRE ATT\u0026CK:\u003c/h5\u003e\u003cp\u003e\u003c/p\u003e\u003ctable class=\"text-center\"\u003e\u003cthead class=\"bg-grey\"\u003e\u003ctr\u003e\u003cth style=\"width: 20%;\"\u003eTactic\u003c/th\u003e\u003cth\u003eTechnique\u003c/th\u003e\u003cth\u003eDescription\u003c/th\u003e\u003cth style=\"width: 20%;\"\u003eObservable\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommand and Control\u003cbr/\u003eDefense Evasion\u003cbr/\u003ePersistence\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1205 - Traffic Signaling\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker employs “magic” values to trigger response.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003e“Magic” byte sequence\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommand and Control\u003cbr/\u003eDefense Evasion\u003cbr/\u003ePersistence\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1205.002 - Traffic Signaling: Socket Filters\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker attaches filter to a network socket.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eUsage of Berkley Packet Filter\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommand and Control\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1573 - Encrypted Channel\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker employs encrypted Command \u0026 Control communication.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eUsage of libtomcrypt\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eExecution\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1106 – Native API\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker calls upon native OS APIs in order to execute behaviors.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eUsage of popen\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eEarlier variant analysis\u003c/strong\u003e:\u003cbr/\u003e\u003ca href=\"https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor\" target=\"_blank\"\u003ehttps://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eDeep Instinct takes a prevention-first approach to stopping ransomware and other malware using the world’s first and only purpose-built, deep learning cybersecurity framework. We prevent ransomware, zero-day threats, and previously unknown malware in \u0026lt;20 milliseconds, 750x faster than the fastest ransomware can encrypt. Deep Instinct has \u0026gt;99% zero-day accuracy and promises a \u0026lt;0.1% false positive rate. The Deep Instinct Prevention Platform is an essential addition to every security stack – providing complete, multi-layered protection against threats across hybrid environments.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e","_metadata":{"uid":"cse5bc0e2e82aae188"}}}],"publication_date":"2023-05-10T18:00:00.000Z","seo":{"seo_title":"BPFDoor Malware Evolves – Stealthy Sniffing Backdoor ups its Game | Deep Instinct","seo_metakeywords":"","seo_metadescription":"BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise. The malware gets its name from its usage of a Berkley Packet Filter – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic. ","image":{"parent_uid":"blt9c31661088dd7a65","uid":"bltd8c463dc3a603391","created_by":"bltc9f76683df0aaacc","updated_by":"bltc9f76683df0aaacc","created_at":"2023-05-10T18:08:21.709Z","updated_at":"2023-05-10T18:08:21.709Z","content_type":"image/jpeg","file_size":"83174","filename":"blog-image-bpfdoor-malware.jpg","title":"blog-image-bpfdoor-malware.jpg","ACL":{},"_version":1,"is_dir":false,"tags":[],"publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2023-05-10T18:14:21.218Z","user":"bltc9f76683df0aaacc"},"url":"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltd8c463dc3a603391/645bdd954ebc818bac33eac7/blog-image-bpfdoor-malware.jpg"},"hide":false},"tags":[],"title":"BPFDoor Malware Evolves – Stealthy Sniffing Backdoor Ups Its Game","updated_at":"2023-05-11T17:29:17.879Z","updated_by":"bltc9f76683df0aaacc","url":"/blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game","publish_details":{"environment":"blt1b1ee2a5b0429c28","locale":"en-us","time":"2023-05-11T17:29:31.903Z","user":"bltc9f76683df0aaacc"},"processed_blocks":[{"name":"richtext_block","content":{"id":"cse5bc0e2e82aae188","body":"\u003ch5\u003eWhat is BPFdoor?\u003c/h5\u003e\u003cp\u003eBPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise.\u003c/p\u003e\u003cp\u003eThe malware gets its name from its usage of a \u003ca href=\"https://en.wikipedia.org/wiki/Berkeley_Packet_Filter\" target=\"_blank\"\u003eBerkley Packet Filter\u003c/a\u003e – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic.\u003c/p\u003e\u003cp\u003eThe malware is associated with a Chinese threat actor, Red Menshen (AKA Red Dev 18), which has been observed targeting telecommunications providers across the Middle East and Asia, as well as entities in the government, education, and logistics sectors since 2021.\u003c/p\u003e\u003cp\u003eWhen it was first discovered, approximately one year ago, BPFdoor was noted for its effective and elegant design and its high emphasis on stealth – an essential element in maintaining undetected long-term persistence.\u003c/p\u003e\u003cp\u003eRecently, Deep Instinct’s threat lab observed and analyzed a previously undocumented and fully undetected new variant of BPFdoor.\u003c/p\u003e\u003ch5\u003eNew, Stealthier Variant\u003c/h5\u003e\u003cp\u003eSeveral key differences that make this new variant even stealthier compared to the previous version include the following:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ctable class=\"text-center\"\u003e\u003cthead class=\"bg-grey\"\u003e\u003ctr\u003e\u003cth style=\"width: 24%;\"\u003e\u0026nbsp;\u003c/th\u003e\u003cth style=\"width: 38%;\"\u003e“New stealthy” 2023 variant\u003c/th\u003e\u003cth\u003e“Old” 2022 variant\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eEncryption\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eStatic library encryption\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eRC4 Encryption\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommunication\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eReverse-Shell\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eBind shell and iptables\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommands\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eNo hardcoded commands – all commands are sent through the reverse-shell\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eHardcoded commands\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eFilenames\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eNot hardcoded\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eHardcoded\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eOne of the most significant differences compared to the previous variant lies in the removal of many of its hardcoded indicators, making the newer version more difficult to detect. Since first seen on VirusTotal in February 2023, the new variant remained undetected and is still undetected as of this writing.\u003c/p\u003e\u003ch5\u003eBPFdoor Technical Analysis\u003c/h5\u003e\u003cp\u003eWhen executed, the BPFdoor sample will attempt to create and get a lock on a runtime file at \u003cem\u003e“/var/run/initd.lock”\u003c/em\u003e and will exit if it fails using that file as a makeshift mutex.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt6b1f7a605acf0d71\" alt=\"Figure 1 - BPFdoor \" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt6b1f7a605acf0d71/645bce382f97ad6087afc2a7/fig01-lock-mutex.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 1 - BPFdoor \"mutex\" check\u003c/figcaption\u003e\u003c/figure\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eIf successful, BPFdoor will fork itself and continue to run as a child process and in this context will close its \u003cem\u003estdin\u003c/em\u003e, \u003cem\u003estdout\u003c/em\u003e, and \u003cem\u003estderr\u003c/em\u003e streams, and set itself to ignore the following operating system signals:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ctable class=\"text-center\"\u003e\u003cthead class=\"bg-grey\"\u003e\u003ctr\u003e\u003cth style=\"width: 16%;\"\u003eSignal Number\u003c/th\u003e\u003cth style=\"width: 21%;\"\u003eSignal Name\u003c/th\u003e\u003cth\u003eSignal Description\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e1\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGHUP\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGHUP (\"signal hang-up\") is a signal sent to a process when its controlling terminal session is closed.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e2\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGINT\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGINT (“signal interrupt”) is a signal sent when a user interrupts a program (Ctrl + C)\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e3\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGQUIT\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGQUIT is a signal sent to terminate a process.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e13\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGPIPE\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGPIPE is a signal sent when a pipe breaks.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e17\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGCHLD\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGCHLD is a signal sent when a child process exits.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e21\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTIN\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTIN is a signal sent to a process attempting to read from the same terminal session and is blocked.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003e23\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTOU\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eSIGTTOU is a signal sent to a process attempting to write to the same terminal session and is blocked.\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eIgnoring these signals hardens BPFdoor against tampering with its processes.\u003c/p\u003e\u003cp\u003eHaving set up the above, BPFdoor then allocates a memory buffer and creates a socket as follows:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltb66f26dd618af2fe\" alt=\"Figure 2 - Socket arguments\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltb66f26dd618af2fe/645bce386d595aca93fa2ebf/fig02-socket-args.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 2 - Socket arguments\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blte9215556a7459197\" alt=\"Figure 3 - Socket creation\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blte9215556a7459197/645bce388a8445ca97101283/fig03-call-socket.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 3 - Socket creation\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eIt will proceed to specify the following socket options using setsockopt:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltff07360ec7be9930\" alt=\"Figure 4 - Setsockopt options\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltff07360ec7be9930/645bce388dbb82c3c233f5f4/fig04-setsockopts.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 4 - Setsockopt options\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt0e81a161934c6431\" alt=\"Figure 5 - Call to setsockopt\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt0e81a161934c6431/645bce38e4e69e5cbc037449/fig05-call-setsockopts.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 5 - Call to setsockopt\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eAnd will read from it in a loop (further described below) using recvfrom:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt7a59c922701ee083\" alt=\"Figure 6 - Recvfrom arguments\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt7a59c922701ee083/645bce38065c95739056107a/fig06-recvfrom.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 6 - Recvfrom arguments\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt811bbcab6a1bb954\" alt=\"Figure 7 - Recvfrom call\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt811bbcab6a1bb954/645bce38367cefb5428f68a2/fig07-loop-call-recvfrom.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 7 - Recvfrom call\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eAn interesting point in the above-described flow is that the \u003cem\u003e“addr”\u003c/em\u003e parameter is zeroed out in the call to \u003cem\u003erecvfrom\u003c/em\u003e; it should point to a specific address from which to read data. The socket is not connected and no bind or listen calls have been made. So, what exactly is going on here?\u003c/p\u003e\u003cp\u003eInterpreting the exact arguments that are used to create the socket reveals that the call is structured as follows:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt36f6534323294019\" alt=\"Figure 8 - Socket call\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt36f6534323294019/645bce38367cefe17b8f689e/fig08-socket_eth.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 8 - Socket call\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eThis creates the socket as a special packet sniffing socket which is able to read every packet that is sent to the machine from the ethernet layer and above without being bound to any specific protocol.\u003c/p\u003e\u003cp\u003eBPFdoor employs this type of packet sniffing socket to read data with \u003cem\u003erecvfrom\u003c/em\u003e, even without an \u003cem\u003e“addr”\u003c/em\u003e parameter, by using the loop below to search for a specific “magic” byte sequence:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltf3c3312b0751a812\" alt=\"Figure 9 - Looped search for \" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltf3c3312b0751a812/645bce388929af83080777c5/fig09-read-loop.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 9 - Looped search for \"magic\" byte sequence (highlighted)\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e“Magic” byte sequence: \u003cstrong\u003e\\x44\\x30\\xCD\\x9F\\x5E\\x14\\x27\\x66\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eOnce found, the loop will break and BPFdoor will continue to Its next phase of operation.\u003c/p\u003e\u003cp\u003eBut, that creates quite a lot of traffic that BPFdoor will need to go through.\u003c/p\u003e\u003cp\u003eLet’s examine the usage of setsockopt a bit further. When parsing its arguments, we arrive at the following code:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt734c1601420f27c9\" alt=\"Figure 10 - Setsockopt attaches BPF\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt734c1601420f27c9/645bce4b7e7e7b9bafe70a08/fig10-setsockopt-args.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 10 - Setsockopt attaches BPF\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eThis is where BPFdoor gets its name from. The above code that attaches a \u003ca href=\"https://en.wikipedia.org/wiki/Berkeley_Packet_Filter\" target=\"_blank\"\u003eBerkley Packet Filter\u003c/a\u003e to the socket; this is the very same mechanism that underpins infosec staples such as libpcap and allows BPFdoor to filter out “uninteresting” types of data coming through its socket.\u003c/p\u003e\u003cp\u003eA Berkley Packet Filter can be defined as in the example below, which allows TCP over IPv4:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt89210974b140db77\" alt=\"Figure 11 - BPF example\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt89210974b140db77/645bce4b065c95264056107e/fig11-bpf-example.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 11 - BPF example\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eBy setting the socket option SO_ATTACH_FILTER and pointing filter to the following sock_filter_code:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt3a9b0cf5b5fbc758\" alt=\"Figure 12 - BPF sock_filter_code\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt3a9b0cf5b5fbc758/645bce4b1f0a4c5876e36beb/fig12-sock-filter-codev3.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 12 - BPF sock_filter_code\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eBPFdoor guides the kernel to set up its socket to only read UDP, TCP, and SCTP traffic coming through ports 22 (ssh), 80 (http), and 443 (https).\u003c/p\u003e\u003cp\u003eBecause of its positioning at such a low level, BPFdoor does not abide by any firewall rules, and can bypass any firewall restrictions on incoming traffic and listen for packets that otherwise wouldn't have surfaced to the machine's user mode.\u003c/p\u003e\u003cp\u003eWhen BPFdoor finds a packet containing its “magic” bytes in the filtered traffic it will treat it as a message from its operator and will parse out two fields and will again fork itself.\u003c/p\u003e\u003cp\u003eThe parent process will continue and monitor the filtered traffic coming through the socket while the child will treat the previously parsed fields as a Command \u0026 Control IP-Port combination and will attempt to contact it.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt59a3decfdb9a8b40\" alt=\"Figure 13 - Connect to Command \u0026 Control\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt59a3decfdb9a8b40/645bce4b8a84453a7a101287/fig13-connect-c2.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 13 - Connect to Command \u0026 Control\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eAn interesting point to note, this variant of BPFdoor contains a pre-compiled version of \u003ca href=\"https://github.com/libtom/libtomcrypt\" target=\"_blank\"\u003elibtomcrypt\u003c/a\u003e, an open-source encryption library, as can be seen in the sample’s contained strings, which also offer a few additional insights:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt8e6c0a33246bf7b3\" alt=\"Figure 14 - Contained strings\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt8e6c0a33246bf7b3/645bce4b291ca448ab7458bf/fig14-libtom-strings.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 14 - Contained strings\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eWe can see that the library was compiled at the beginning of October 2022 using GCC on a system running Red Hat Linux. This may suggest that this variant has been operational significantly earlier than its first appearance on VirusTotal.\u003c/p\u003e\u003cp\u003eBy compiling our own version of the library in similar fashion and using \u003cem\u003ebindiff\u003c/em\u003e to compare against BPFdoor we can see its statically linked exports:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt816a0cb45cfa1a28\" alt=\"Figure 15 - Libtomcrypt bindiff snippet\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt816a0cb45cfa1a28/645bce4b2f97ad7a76afc2ab/fig15-libtom-bindiff.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 15 - Libtomcrypt bindiff snippet\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eHaving made the comparison, we determined that BPFdoor is using libtomcrypt functionality to set up a secure and encrypted “reverse-shell” session with its Command \u0026 Control. This replaced its previous mechanism.\u003c/p\u003e\u003cp\u003eAfter this session is established, BPFdoor will begin a loop that can be described by the following:\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"bltb2ff1c169f93cb84\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/bltb2ff1c169f93cb84/645bce3822f9986ff5c5974b/BPFDOORv2Flow.png\" style=\"text-align: center;\"/\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003ch5\u003eConclusion\u003c/h5\u003e\u003cp\u003eBPFdoor retains its reputation as an extremely stealthy and difficult-to-detect malware with this latest iteration.\u003c/p\u003e\u003cp\u003eRegardless of whether one considers the encryption library compilation time (October 2022) or its initial submission to VirusTotal (February 2023) as indicative of when this sample was first put into use, it is truly amazing how long it has remained fully undetected.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt93ffef0dee975742\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt93ffef0dee975742/645d25159c40aa50cb074137/fig16-vt-0detectionv3.png\" style=\"text-align: center;\"/\u003e\u003c/figure\u003e\u003cfigure style=\"margin-top: auto;margin-right: auto;margin-bottom: auto;margin-left: auto;text-align: center;width: auto;\"\u003e\u003cimg asset_uid=\"blt940800074dbf8141\" alt=\"Figure 16 \u0026 17 - 0 VirusTotal detections, 7 different scans.\" src=\"https://images.contentstack.io/v3/assets/blt1ec077b6b53d6b3e/blt940800074dbf8141/645bce4b32acc8af715ee19b/fig17-vt-many-scans.png\" style=\"text-align: center;\"/\u003e\u003cfigcaption style=\"text-align: center;\"\u003eFigure 16 \u0026 17 - 0 VirusTotal detections, 7 different scans.\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ch5\u003eIOCs\u003c/h5\u003e\u003cp\u003eafa8a32ec29a31f152ba20a30eb483520fe50f2dce6c9aa9135d88f7c9c511d7 – BPFDoor ELF SHA256\u003cbr/\u003e/var/run/initd.lock – BPFDoor \"mutex”\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003ch5\u003eMITRE ATT\u0026CK:\u003c/h5\u003e\u003cp\u003e\u003c/p\u003e\u003ctable class=\"text-center\"\u003e\u003cthead class=\"bg-grey\"\u003e\u003ctr\u003e\u003cth style=\"width: 20%;\"\u003eTactic\u003c/th\u003e\u003cth\u003eTechnique\u003c/th\u003e\u003cth\u003eDescription\u003c/th\u003e\u003cth style=\"width: 20%;\"\u003eObservable\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommand and Control\u003cbr/\u003eDefense Evasion\u003cbr/\u003ePersistence\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1205 - Traffic Signaling\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker employs “magic” values to trigger response.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003e“Magic” byte sequence\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommand and Control\u003cbr/\u003eDefense Evasion\u003cbr/\u003ePersistence\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1205.002 - Traffic Signaling: Socket Filters\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker attaches filter to a network socket.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eUsage of Berkley Packet Filter\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eCommand and Control\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1573 - Encrypted Channel\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker employs encrypted Command \u0026 Control communication.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eUsage of libtomcrypt\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003cp\u003eExecution\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eT1106 – Native API\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eAttacker calls upon native OS APIs in order to execute behaviors.\u003c/p\u003e\u003c/td\u003e\u003ctd\u003e\u003cp\u003eUsage of popen\u003c/p\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eEarlier variant analysis\u003c/strong\u003e:\u003cbr/\u003e\u003ca href=\"https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor\" target=\"_blank\"\u003ehttps://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003eDeep Instinct takes a prevention-first approach to stopping ransomware and other malware using the world’s first and only purpose-built, deep learning cybersecurity framework. We prevent ransomware, zero-day threats, and previously unknown malware in \u0026lt;20 milliseconds, 750x faster than the fastest ransomware can encrypt. Deep Instinct has \u0026gt;99% zero-day accuracy and promises a \u0026lt;0.1% false positive rate. The Deep Instinct Prevention Platform is an essential addition to every security stack – providing complete, multi-layered protection against threats across hybrid environments.\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e"}}]},"preview":false,"headerTheme":{"theme":"white"},"headerMenu":{"main":[{"id":"cs9d6eb1ca84ab5529","text":"Products","subMenu":[{"menuColumn":{"link":{"title":"","url":""},"menuItems":[{"title":"Prevention Platform","url":"/platform","id":"cs131597e8802151fa"},{"title":"Prevention for Applications","url":"/prevention-for-applications","id":"csdde7d7af5d13f027"},{"title":"Prevention for Endpoints","url":"/endpoint-security","id":"cs410b32f532434327"}]}}]},{"id":"csd06e2184e511fdab","text":"Solutions","subMenu":[{"menuColumn":{"link":{"title":"","url":""},"menuItems":[{"title":"Prevent Ransomware","url":"/ransomware-protection-solution","id":"cs96b6728ffd35efd9"},{"title":"Prevent Zero-Day Attacks","url":"/zero-day-attacks","id":"csd589095551288aa1"},{"title":"Improve EPP Efficacy","url":"/endpoint-protection-platforms","id":"cs055072005e66b4a0"},{"title":"Extend \u0026 Enhance EDR","url":"/endpoint-detection-response","id":"cs8fd124ca5dd3abdd"},{"title":"Stop Fileless Attacks","url":"/prevent-fileless-malware","id":"cs2c0eac26b145d5de"}]}}]},{"id":"cs0b135af0b713e8bd","text":"Why Deep Instinct","subMenu":[{"menuColumn":{"link":{"title":"","url":""},"menuItems":[{"title":"Deep Learning in Cybersecurity","url":"/why-deep-instinct","id":"csb80c8d530b4ea6b8"},{"title":"Our Customers","url":"/customers","id":"cscb35501e2dc2945a"},{"title":"+ MS Defender","url":"/vs-microsoft-defender","id":"cs7826e7c53d89dcbd"},{"title":"VS Traditional Antivirus","url":"/deep-instinct-vs-competitors","id":"cs53c4eb449eac5818"}]}}]},{"id":"cs9a1685332616ab04","text":"Resources","subMenu":[{"menuColumn":{"link":{"title":"","url":""},"menuItems":[{"title":"Asset Library","url":"/resources","id":"cs7a31018d4de08f4e"},{"title":"Blog","url":"/blog","id":"cs1c561d1aa853b2a3"},{"title":"Videos","url":"/videos","id":"cs59d61494e24b98d1"},{"title":"Events \u0026 Webinars","url":"/events-webinars","id":"cs252bd6790d094b06"},{"title":"Training","url":"/deep-instinct-training","id":"csf91b0953931eb246"}]}}]},{"id":"csc64757ccf4d2c9c8","text":"Company","subMenu":[{"menuColumn":{"link":{"title":"","url":""},"menuItems":[{"title":"About Deep Instinct","url":"/about-us","id":"cs015ea2b646946fb3"},{"title":"Leadership Team","url":"/company/leadership-team","id":"cs19c86badbe85fe86"},{"title":"Board of Directors","url":"/company/board-of-directors","id":"cs42440c18ad998967"},{"title":"Newsroom","url":"/newsroom","id":"cs26c3af4216f35f16"},{"title":"Careers","url":"/careers","id":"cs423626cb5ec6ce5f"},{"title":"Contact Us","url":"/contact-us","id":"cs764c5e9dc04978ad"}]}}]},{"id":"csd58f79895273e8bc","text":"Request Demo","url":"https:/info.deepinstinct.com/request-a-demo"}],"secondary":[{"title":"Partners","url":"/partners","id":"sub-0"},{"title":"Login","url":"https://portal.deepinstinct.com","id":"sub-1"}]},"footerMenu":{"sections":[{"title":"Products","links":[{"title":"Prevention Platform","url":"/platform","id":"cs778c0921797e2796"},{"title":"Prevention for Applications","url":"/prevention-for-applications","id":"csdba3cab8bdda7742"},{"title":"Prevention for Endpoints","url":"/endpoint-security","id":"csa70948fea32fbbf2"}]},{"title":"Solutions","links":[{"title":"Prevent Ransomware","url":"/ransomware-protection-solution","id":"cs2214fff82ddd3616"},{"title":"Prevent Zero-Day Attacks","url":"/zero-day-attacks","id":"cse96c44cc9c09ed4c"},{"title":"Improve EPP Efficacy","url":"/endpoint-protection-platforms","id":"csf4bd1faa5f87416a"},{"title":"Extend \u0026 Enhance EDR","url":"/endpoint-detection-response","id":"cs5bc994a7a81c036b"},{"title":"Stop Fileless Attacks","url":"/prevent-fileless-malware","id":"cs9278f4b9e9ad1680"}]},{"title":"Why Deep Instinct","links":[{"title":"Deep Learning in Cybersecurity","url":"/why-deep-instinct","id":"csf9d0678478c406ad"},{"title":"Our Customers","url":"/customers","id":"cs045d85ce96926cbf"},{"title":"+ MS Defender","url":"/vs-microsoft-defender","id":"cs67138ccc3b252dca"},{"title":"VS Traditional Antivirus","url":"/deep-instinct-vs-competitors","id":"cs5c216b6e94d62052"}]},{"title":"Company","links":[{"title":"About Deep Instinct","url":"/about-us","id":"csc6b43b0e74f8d5b9"},{"title":"Newsroom","url":"/newsroom","id":"cs4c0d16a30b844a3a"},{"title":"Careers","url":"/careers","id":"cs0067fb583a95b6f5"},{"title":"Contact Us","url":"/contact-us","id":"cs77bdd8a50eaccb34"}]},{"title":"Resources","links":[{"title":"Asset Library","url":"/resources","id":"cs153459fa2c69b5fa"},{"title":"Blog","url":"/blog","id":"csd71fc821e3188000"},{"title":"Videos","url":"/videos","id":"csb2971784354462d7"},{"title":"Training","url":"/deep-instinct-training","id":"cs2352c64271ced2e4"}]},{"title":"Quick links","links":[{"title":"Request Demo","url":"/request-a-demo","id":"csaa8b34ab12cb5cd8"},{"title":"Customer Portal","url":"https://portal.deepinstinct.com/","id":"cs2f3b3980139db7ea"},{"title":"Integrations and Compliance","url":"/compliance-certification-evaluation","id":"cs700479e71aace5c7"}]}],"socialLinks":[{"text":"youtube","url":"https://www.youtube.com/channel/UCYerfisJf3hc9QOWmic1G9Q"},{"text":"linkedin","url":"https://www.linkedin.com/company/deep-instinct"},{"text":"twitter","url":"https://twitter.com/DeepInstinctSec"},{"text":"facebook","url":"https://www.facebook.com/DeepInstinctInc"}],"secondaryLinks":[{"text":"Privacy Policy","url":"/privacy-policy"},{"text":"Terms of use","url":"/terms-of-use"}],"hideFooterMenu":false},"hideHeaderMenu":false,"hideFooterMenu":false,"hideSitewideAlert":false,"disableStickyHeader":false,"siteWideAlert":{"title":"Deep Instinct Included in the 2022 Gartner® Magic Quadrant™ for Endpoint Protection Platforms (EPP)","cta":{"text":"Learn more","url":"/blog/who-is-the-only-new-vendor-in-the-2022-gartner-magic-quadrant-for-endpoint-protection-platforms"}},"meta":{"title":"BPFDoor Malware Evolves – Stealthy Sniffing Backdoor ups its Game | Deep Instinct","keywords":"","description":"BPFdoor is a Linux-specific, low-profile, passive backdoor intended to maintain a persistent, long-term foothold in already-breached networks and environments and functions primarily to ensure an attacker can re-enter an infected system over an extended period of time, post-compromise. The malware gets its name from its usage of a Berkley Packet Filter – a fairly unique way of receiving its instructions and evading detection, which bypasses firewall restrictions on incoming traffic. ","image":"https://www.deepinstinct.com/image/bltd8c463dc3a603391/645bdd954ebc818bac33eac7/blog-image-bpfdoor-malware.jpg","created":"2023-05-10T18:00:00.000Z","updated":"2023-05-11T17:29:17.879Z","hide":false},"url":"blog/bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game","translations":[],"lang":"en"},"__N_SSG":true},"page":"/blog/[pid]","query":{"pid":"bpfdoor-malware-evolves-stealthy-sniffing-backdoor-ups-its-game"},"buildId":"m35S_mu-AiQUHee5tDoVa","runtimeConfig":{"baseUrl":"https://www.deepinstinct.com","locales":{"en":"en-us","ja":"ja","fr":"fr","de":"de"},"defaultLocale":"en","contentTypes":{"modularPage":{"name":"di_modular_page","revalidate":300,"sitemap":{"changefreq":"daily","priority":0.5},"prefix":"modular","options":{"include":["modular_blocks.others.components.list_featured_resources.resources","modular_blocks.others.components.list_featured_resources.featured_resources"]}},"author":{"name":"di_author"},"blogPost":{"name":"di_blog_post","revalidate":300,"prefix":"blog","modularUrl":"blog/all","sortings":{"desc":"publication_date"},"author":true,"rss":{"title":"Deep Instinct Blog: Breaking News and Updates","description":"Deep Instinct prevents more advanced threats than any EPP or EDR in the world."},"listingLimit":10,"sitemap":{"changefreq":"monthly","priority":0.5}},"pressRelease":{"name":"di_press_release","prefix":"news","revalidate":60,"author":false,"sortings":{"desc":"publication_date"},"rss":{"title":"Deep Instinct News","description":"Deep Instinct prevents more advanced threats than any EPP or EDR in the world."},"sitemap":{"changefreq":"monthly","priority":0.5},"listingLimit":10},"newsCoverage":{"name":"di_news_coverage","prefix":"news-coverage","modularUrl":"news-coverage","revalidate":300,"sortings":{"desc":"date"},"listingLimit":12},"biosListing":{"name":"di_bios_listing","prefix":"company","revalidate":600},"pdfPage":{"name":"di_pdf_resources","prefix":"pdf","revalidate":600,"sitemap":{"changefreq":"monthly","priority":0.5}},"embedPage":{"name":"di_embed","prefix":"embed","revalidate":600},"videoPage":{"name":"di_video_page","prefix":"video","revalidate":600,"sitemap":{"changefreq":"monthly","priority":0.5}},"jobListing":{"name":"di_job_listing"},"glossaryTerm":{"name":"di_glossary_term","revalidate":300,"prefix":"glossary","themeColors":"blue","sortings":{"desc":"publication_date"},"sitemap":{"changefreq":"monthly","priority":0.5}},"resource":{"name":"di_resource","sortings":{"desc":"created_at"}}},"revalidationByUrl":{"/blog":60,"/news":60},"menus":{"name":"di_menus","reference":["header_menu.menu_section.menu_columns.menu_column.menu_items.link_reference.reference","footer_menu.menu_section.menu_items.link_reference.reference"],"referenceFields":"url"},"meta":{"title":"The Deep Learning AI Cybersecurity Platform, Offering Cyber Threat Prevention Solutions.","siteName":"Deep Instinct","description":"","twitterSite":"@DeepInstinctSec"},"homePageUrl":"/index","themeColors":{"dark":"dark","blue":"blue","light":"light","white":"white"},"rss":{"limit":10,"authorFallback":"Deep Instinct"}},"isFallback":false,"dynamicIds":[248],"gsp":true,"locale":"en","locales":["en","ja","fr","de"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>